!function(){function t(){this.boxDOM=null,this.tooltipDOM=null,this.groups=[],this.init=function(t){if(this.boxDOM=document.querySelector(t),!this.boxDOM)throw Error("Cannot find container DOM, RxjsDraw must input a valid css selector of the container.");this.boxDOM.classList.add("rxjs-box"),this.tooltipDOM=o("pre",this.boxDOM,{class:"rxjs-tooltip"})},this.clean=function(){this.stop(),this.groups=[],this.boxDOM.innerHTML=""},this.stop=function(){for(var t=0;t<this.groups.length;t++)this.groups[t].stop()},this.findGroup=function(t){return this.groups.find(function(i){return i.rootObservable===r(t)})},this.addGroup=function(t){return this.groups.push(t),this.group}}function i(t,i){this.dom=null,this.rootObservable=i,this.sources=[],this.sourceBoxes=[],this.init=function(){this.dom=o("div",t,{class:"rxjs-group"})},this.stop=function(){for(var t=0;t<this.sourceBoxes.length;t++)this.sourceBoxes[t].timeline.stop()},this.addSource=function(t){this.sources.push(t)},this.addSourceBox=function(t){this.sourceBoxes.push(t)},this.drawOperatorBoxes=function(t){for(var i=t,s=o("div",this.dom,{class:"rxjs-operators"});i!==this.sources[this.sources.length-2];)i.operator&&o("div",s,{class:"rxjs-operator",innerHTML:i.operator.constructor.name}),i===this.rootObservable&&o("div",s,{class:"rxjs-operator",innerHTML:i.constructor.name}),i=i.source},this.init()}function s(t,i){this.dom=null,this.name=i,this.timeline=null,this.init=function(){this.dom=o("div",t,{id:this.name,class:"rxjs-source"}),o("div",this.dom,{class:"rxjs-name",innerHTML:this.name})},this.init()}function e(t){var i=this;this.dom=null,this.bar={dom:null,width:0},this.startTime=0,this.marbles=[],this.timerSubject=null,this.timerSubscription=null,this.scrollSubject=null,this.syncScrollSubscription=null,this.autoScrollSubscription=null,this.init=function(){this.dom=o("div",t,{class:"rxjs-timeline-container"}),this.bar.dom=o("div",this.dom,{class:"rxjs-timeline"}),this.startTime=Date.now(),this.timerSubject=Rx.Observable.of(0,Rx.Scheduler.animationFrame).repeat().map(Date.now).share(),this.scrollSubject=Rx.Observable.fromEvent(this.dom,"scroll").share(),Rx.Observable.fromEvent(this.dom,"mousemove").subscribe(function(t){var s=t.target;if(s.matches(".rxjs-marble")){var e=Array.prototype.indexOf.call(s.parentNode.childNodes,s),r=i.marbles[e],l=r.value;if("object"==typeof r.value&&r.value&&"Object"===r.value.constructor.name)try{l=JSON.stringify(l,null,2)}catch(t){l=r.value}n.tooltipDOM.innerHTML=l,o("div",n.tooltipDOM,{innerHTML:"Type: "+typeof r.value}),o("div",n.tooltipDOM,{innerHTML:"Time: "+(r.time-i.startTime)+"ms"}),n.tooltipDOM.style.left=t.clientX+"px",n.tooltipDOM.style.top=t.clientY+"px",n.tooltipDOM.style.display="inline-block"}else n.tooltipDOM.style.display="none"}),Rx.Observable.fromEvent(this.dom,"mouseleave").subscribe(function(){n.tooltipDOM.style.display="none"}),this.syncScrollSubsciption=this.scrollSubject.subscribe(function(t){for(var s=i.dom.parentNode.parentNode.querySelectorAll(".rxjs-timeline-container"),e=0;e<s.length;e++)s[e].scrollLeft=i.dom.scrollLeft})},this.start=function(){this.timerSubscription=this.timerSubject.subscribe(function(t){i.bar.width=100*(t-i.startTime)/1e3,i.bar.dom.style.width=i.bar.width+"px"});var t=this.scrollSubject.throttleTime(100).pluck("target","scrollLeft").pairwise().filter(function(t){return t[0]>t[1]});this.autoScrollSubscription=this.timerSubject.takeUntil(t).subscribe(function(t){i.dom.scrollLeft=i.dom.scrollWidth})},this.stop=function(){this.timerSubscription.unsubscribe(),this.autoScrollSubscription.unsubscribe()},this.push=function(t){var i=t;"number"==typeof t?(i=t.toString()).length>4&&(i="[N]"):"string"==typeof t?t.length>4&&(i="[S]"):"boolean"==typeof t?i=t.toString():"function"==typeof t?i="[F]":"object"==typeof t?i=null===t?"null":"[O]":void 0===t&&(i="[U]");var s=this.marbles.length?this.marbles[this.marbles.length-1]:null,e=0,r=this.bar.width;s&&s.left===r&&(e=s.top+5);var n={time:(new Date).getTime(),value:t,display:i,top:e,left:r};this.marbles.push(n);var l=o("div",this.bar.dom,{class:"rxjs-marble",innerHTML:i});l.style.top=n.top+"px",l.style.left=n.left+"px"},this.error=function(){this.bar.dom.classList.add("rxjs-timeline-error")},this.complete=function(){this.bar.dom.classList.add("rxjs-timeline-complete")},this.init()}function o(t,i,s){var e=document.createElement(t);if(s.id&&(e.id=s.id),s.class&&("string"==typeof s.class?e.classList.add(s.class):e.classList.add.apply(e.classList,s.class)),s.innerHTML&&(e.innerHTML=s.innerHTML),s.dataset)for(var o in s.dataset)e.dataset[o]=s.dataset[o];return i.appendChild(e),e}function r(t){for(var i=t;i.source;)i=i.source;return i}if(!window.Rx)throw Error("'Rx' not found. You should have include RxJS library to continue.");var n=new t;Rx.Observable.prototype.draw=function(t){var o=this,l=n.findGroup(this);l||(l=new i(n.boxDOM,r(this)),n.addGroup(l)),l.addSource(this),l.drawOperatorBoxes(this);var a=new s(l.dom,t);l.addSourceBox(a),a.timeline=new e(a.dom),a.timeline.start();var c=Rx.Observable.create(function(t){return o.subscribe(function(i){try{a.timeline.push(i),t.next(i)}catch(i){a.timeline.stop(),a.timeline.error(),t.error(i)}},function(i){a.timeline.stop(),a.timeline.error(),t.error(i)},function(){a.timeline.stop(),a.timeline.complete(),t.complete()})});return c.source=this,c},t.prototype.createAndAppend=o,t.prototype.findRootObservable=r,window.rxjsDraw=n}();
//# sourceMappingURL=rxjs-draw.min.js.map
